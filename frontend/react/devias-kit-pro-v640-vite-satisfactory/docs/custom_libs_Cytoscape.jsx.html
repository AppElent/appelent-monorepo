<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: custom/libs/Cytoscape.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: custom/libs/Cytoscape.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import CytoscapeComponent from 'react-cytoscapejs';
import { useEffect, useRef, useState } from 'react';
import popper from 'cytoscape-popper';
import DefaultCytoscape from 'cytoscape';
import { Button, Container, Stack } from '@mui/material';

DefaultCytoscape.use(popper);

const Cytoscape = ({ elements, layout, ...options }) => {
  const cyRef = useRef(null);
  const popperRef = useRef(null);
  const popupRef = useRef(null);
  const graphRef = useRef(null);
  const [doFirstRender, setDoFirstRender] = useState(false);
  const [popupNode, setPopupNode] = useState(null);
  // graph page: https://github.com/Greven145/yet-another-factory-planner/blob/master/client/src/containers/ProductionPlanner/PlannerResults/ProductionGraphTab/index.tsx
  // tooltip: https://github.com/Greven145/yet-another-factory-planner/blob/master/client/src/components/GraphTooltip/index.tsx

  console.log(elements, layout);

  /**
   *
   * @param instance
   */
  function setCyRef(instance) {
    if (instance &amp;&amp; cyRef.current !== instance) {
      cyRef.current = instance;
      setCyListeners(cyRef.current);
    }
  }

  /**
   *
   * @param graphRef
   */
  function _resizeListener(graphRef) {
    if (graphRef?.current) {
      const bounds = graphRef.current.getBoundingClientRect();
      graphRef.current.style.height = `${window.innerHeight - bounds.top - 50}px`;
      //console.log(graphRef.current.style.height);
      if (cyRef.current) {
        //console.log(cyRef.current);
        cyRef.current.fit();
      }
    }
  }

  /**
   *
   * @param cy
   */
  function setCyListeners(cy) {
    // cy.on('select', 'node', function (e) {
    //   e.target.addClass('selected');
    //   e.target.outgoers('edge').addClass('selected').addClass('selected-outgoing');
    //   e.target.incomers('edge').addClass('selected').addClass('selected-incoming');
    //   deactivatePopper(cy);
    // });

    // cy.on('unselect', 'node', function (e) {
    //   e.target.removeClass('selected');
    //   e.target.outgoers('edge').removeClass('selected').removeClass('selected-outgoing');
    //   e.target.incomers('edge').removeClass('selected').removeClass('selected-incoming');
    //   deactivatePopper(cy);
    // });

    // cy.on('grab', 'node', function (e) {
    //   e.target.addClass('grabbed');
    //   e.target.outgoers('edge').addClass('grabbed').addClass('grabbed-outgoing');
    //   e.target.incomers('edge').addClass('grabbed').addClass('grabbed-incoming');
    //   registerNodePosition(e.target.data('key'), e.target.position('x'), e.target.position('y'));
    //   deactivatePopper(cy);
    // });

    // cy.on('free', 'node', function (e) {
    //   e.target.removeClass('grabbed');
    //   e.target.outgoers('edge').removeClass('grabbed').removeClass('grabbed-outgoing');
    //   e.target.incomers('edge').removeClass('grabbed').removeClass('grabbed-incoming');
    //   if (currentNodePosition &amp;&amp; !areNodesSame(currentNodePosition, { key: e.target.data('key'), x: e.target.position('x'), y: e.target.position('y') })) {
    //     updateStateNodePosition(e.target.data('key'), e.target.position('x'), e.target.position('y'));
    //     ctx.dispatch({ type: 'UPDATE_NODES_POSTIONS', nodesPositions: nodesPositions });
    //     currentNodePosition = undefined;
    //   }
    // });

    cy.on('mouseover', 'node', function (e) {
      const nodeId = e.target.id();
      if (popperRef.current?.nodeId === nodeId) return;
      deactivatePopper(cy);
      activatePopper(cy, e.target);
    });

    cy.on('mouseout', 'node', function (e) {
      const nodeId = e.target.id();
      if (popperRef.current?.nodeId === nodeId) {
        deactivatePopper(cy);
      }
    });
  }

  /**
   *
   * @param instance
   */
  function setGraphRef(instance) {
    if (instance &amp;&amp; !graphRef.current) {
      graphRef.current = instance;
      _resizeListener(graphRef);
      setDoFirstRender(true);
    }
  }

  console.log(popperRef.current, cyRef.current);

  /**
   *
   * @param cy
   * @param node
   */
  function activatePopper(cy, node) {
    const popper = node.popper({
      content: () => popupRef.current || undefined,
      popper: {
        placement: 'top',
      },
    });
    popperRef.current = { popper, nodeId: node.id() };
    node.on('position', () => {
      popper.update();
    });
    cy.on('pan zoom resize', () => {
      popper.update();
    });
    setPopupNode(node);
  }

  /**
   *
   * @param cy
   */
  function deactivatePopper(cy) {
    if (!popperRef.current) return;
    const node = cy.getElementById(popperRef.current.nodeId);
    node.off('position');
    cy.off('pan zoom resize');
    popperRef.current.popper.destroy();
    popperRef.current = null;
    setPopupNode(null);
  }

  useEffect(() => {
    /**
     *
     */
    function resizeListener() {
      _resizeListener(graphRef);
    }
    window.addEventListener('resize', resizeListener);
    return () => {
      window.removeEventListener('resize', resizeListener);
    };
  }, []);

  console.log(popupNode);

  return (
    &lt;Container
      ref={setGraphRef}
      maxWidth={false}
    >
      &lt;Stack
        spacing={1}
        justifyContent="flex-end"
        direction="row"
      >
        &lt;Button
          onClick={() => {
            cyRef.current?.fit();
          }}
          variant="contained"
        >
          Fit Graph
        &lt;/Button>
        {/* &lt;Button
          onClick={() => {
            cyRef.current?.reset();
          }}
          variant="outlined"
        >
          Reset positions
        &lt;/Button> */}
      &lt;/Stack>
      {doFirstRender &amp;&amp; (
        &lt;CytoscapeComponent
          cy={setCyRef}
          elements={elements}
          //style={{ width: '100%', height: '100%' }}
          //style={{ width: '100vw', height: '100vh' }}
          //style={{ height: '45vw', width: '100%', overflow: 'hidden' }}
          layout={layout}
          style={{ height: '70vh', width: '100%', overflow: 'hidden' }}
          // /stylesheet={}
          {...options}
        />
      )}

      &lt;div ref={popupRef}>{JSON.stringify(popupNode?.data())}&lt;/div>
    &lt;/Container>
  );
};

export default Cytoscape;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#EditToolbar">EditToolbar</a></li><li><a href="global.html#NO_OP">NO_OP</a></li><li><a href="global.html#RouterLink">RouterLink</a></li><li><a href="global.html#SatisfactoryGamesFactoryRecipes">SatisfactoryGamesFactoryRecipes</a></li><li><a href="global.html#applyPagination">applyPagination</a></li><li><a href="global.html#applySort">applySort</a></li><li><a href="global.html#capFirst">capFirst</a></li><li><a href="global.html#createGuid">createGuid</a></li><li><a href="global.html#deepCopy">deepCopy</a></li><li><a href="global.html#descendingComparator">descendingComparator</a></li><li><a href="global.html#generateName">generateName</a></li><li><a href="global.html#getComparator">getComparator</a></li><li><a href="global.html#getEdgeLabel">getEdgeLabel</a></li><li><a href="global.html#getNodeClasses">getNodeClasses</a></li><li><a href="global.html#getNodeLabel">getNodeLabel</a></li><li><a href="global.html#getRandomInt">getRandomInt</a></li><li><a href="global.html#pageSizeReducer">pageSizeReducer</a></li><li><a href="global.html#paginate">paginate</a></li><li><a href="global.html#paginationStateReducer">paginationStateReducer</a></li><li><a href="global.html#recipeChart">recipeChart</a></li><li><a href="global.html#totalItemsReducer">totalItemsReducer</a></li><li><a href="global.html#truncateFloat">truncateFloat</a></li><li><a href="global.html#useAnalytics">useAnalytics</a></li><li><a href="global.html#useDialog">useDialog</a></li><li><a href="global.html#useKey">useKey</a></li><li><a href="global.html#useLocalStorage">useLocalStorage</a></li><li><a href="global.html#useNprogress">useNprogress</a></li><li><a href="global.html#usePopover">usePopover</a></li><li><a href="global.html#useRouter">useRouter</a></li><li><a href="global.html#useSearchParams">useSearchParams</a></li><li><a href="global.html#useThreads">useThreads</a></li><li><a href="global.html#useUpdateEffect">useUpdateEffect</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Mon Oct 09 2023 13:07:06 GMT+0200 (Midden-Europese zomertijd)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
